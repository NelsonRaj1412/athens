import React, { useState, useEffect } from 'react';\nimport { Button, Space, Alert, Spin } from 'antd';\nimport { FileImageOutlined, ReloadOutlined } from '@ant-design/icons';\nimport { useDigitalSignature } from '../features/user/hooks/useDigitalSignature';\nimport api from '@common/utils/axiosetup';\n\ninterface AutoSignatureProps {\n  onSignatureGenerated?: (signatureUrl: string) => void;\n  onSignatureFile?: (file: File) => void;\n  disabled?: boolean;\n  buttonText?: string;\n  showPreview?: boolean;\n}\n\n/**\n * Component that automatically uses digital signature templates instead of manual uploads\n * Replaces all signature upload functionality with template-generated signatures\n */\nconst AutoSignature: React.FC<AutoSignatureProps> = ({\n  onSignatureGenerated,\n  onSignatureFile,\n  disabled = false,\n  buttonText = \"Generate Digital Signature\",\n  showPreview = true\n}) => {\n  const { generateSignature, loading } = useDigitalSignature();\n  const [hasTemplate, setHasTemplate] = useState<boolean | null>(null);\n  const [signatureUrl, setSignatureUrl] = useState<string | null>(null);\n  const [checkingTemplate, setCheckingTemplate] = useState(true);\n\n  // Check if user has a signature template\n  useEffect(() => {\n    const checkTemplate = async () => {\n      try {\n        const response = await api.get('/authentication/signature/template/data/');\n        setHasTemplate(response.data.has_existing_template);\n      } catch (error) {\n        setHasTemplate(false);\n      } finally {\n        setCheckingTemplate(false);\n      }\n    };\n\n    checkTemplate();\n  }, []);\n\n  const handleGenerateSignature = async () => {\n    const url = await generateSignature();\n    if (url) {\n      setSignatureUrl(url);\n      onSignatureGenerated?.(url);\n      \n      // Convert to File if callback provided\n      if (onSignatureFile) {\n        try {\n          const response = await api.get(url, { responseType: 'blob' });\n          const blob = response.data;\n          const file = new File([blob], 'signature.png', { type: 'image/png' });\n          onSignatureFile(file);\n        } catch (error) {\n          console.error('Failed to convert signature to file:', error);\n        }\n      }\n    }\n  };\n\n  if (checkingTemplate) {\n    return (\n      <div style={{ textAlign: 'center', padding: '20px' }}>\n        <Spin size=\"small\" />\n        <div style={{ marginTop: 8, fontSize: '12px', color: '#666' }}>\n          Checking signature template...\n        </div>\n      </div>\n    );\n  }\n\n  if (!hasTemplate) {\n    return (\n      <Alert\n        message=\"No Digital Signature Template\"\n        description=\"Please create your digital signature template in your profile first.\"\n        type=\"warning\"\n        showIcon\n        action={\n          <Button size=\"small\" onClick={() => window.location.href = '/dashboard/profile'}>\n            Go to Profile\n          </Button>\n        }\n      />\n    );\n  }\n\n  return (\n    <div>\n      <Space direction=\"vertical\" style={{ width: '100%' }}>\n        <Button\n          type=\"primary\"\n          icon={<FileImageOutlined />}\n          loading={loading}\n          disabled={disabled}\n          onClick={handleGenerateSignature}\n        >\n          {buttonText}\n        </Button>\n        \n        {signatureUrl && showPreview && (\n          <div style={{ \n            border: '1px solid #d9d9d9', \n            borderRadius: '6px', \n            padding: '8px',\n            backgroundColor: '#fafafa',\n            textAlign: 'center'\n          }}>\n            <img \n              src={signatureUrl} \n              alt=\"Generated Signature\" \n              style={{ maxWidth: '100%', maxHeight: '100px' }}\n            />\n            <div style={{ marginTop: 4, fontSize: '12px', color: '#666' }}>\n              Digital signature generated with current date/time\n            </div>\n          </div>\n        )}\n        \n        {signatureUrl && (\n          <Button\n            size=\"small\"\n            icon={<ReloadOutlined />}\n            onClick={handleGenerateSignature}\n            disabled={loading}\n          >\n            Regenerate\n          </Button>\n        )}\n      </Space>\n    </div>\n  );\n};\n\nexport default AutoSignature;